<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statikos užimtumo ataskaitos</title>
    <!-- Bibliotekos iš CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .sticky-col { position: sticky; left: 0; z-index: 10; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7d2fe; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #818cf8; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, Fragment } = React;

        // Ikoniukų SVG komponentai
        const IconFile = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>;
        const IconUpload = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;

        const App = () => {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [fileName, setFileName] = useState("");
            const [errorInfo, setErrorInfo] = useState("");
            const [activeTab, setActiveTab] = useState("ataskaita");
            const [showColPicker, setShowColPicker] = useState(false);
            
            const [startMonth, setStartMonth] = useState("2026-01");
            const [endMonth, setEndMonth] = useState("2026-03");

            const [saleFilter, setSaleFilter] = useState("mokamas");

            const [vis, setVis] = useState({
                s_pot: true, s_free: true, s_used_pct: true, s_free_pct: true,
                k_pot: true, k_used: true, k_used_pct: true, k_free_pct: true
            });

            const [filterCity, setFilterCity] = useState("");
            const [filterCat, setFilterCat] = useState("");
            const [filterStatus, setFilterStatus] = useState("");

            const formatDate = (val) => {
                if (!val) return null;
                if (val instanceof Date) return val.toISOString().split('T')[0];
                if (typeof val === 'number') {
                    const date = new Date((val - 25569) * 86400 * 1000);
                    return date.toISOString().split('T')[0];
                }
                const clean = val.toString().trim();
                if (clean.includes('-')) return clean.split(' ')[0];
                if (clean.includes('.')) {
                    const parts = clean.split('.');
                    if (parts[0].length === 4) return `${parts[0]}-${parts[1]}-${parts[2]}`;
                    return `${parts[2]}-${parts[1]}-${parts[0]}`;
                }
                return clean;
            };

            const findKey = (row, keys) => {
                const rowKeys = Object.keys(row);
                for (const k of keys) {
                    const found = rowKeys.find(rk => rk.toLowerCase().trim() === k.toLowerCase().trim() || rk.toLowerCase().includes(k.toLowerCase()));
                    if (found) return found;
                }
                return null;
            };

            const getSaleType = (text) => {
                if (!text) return "laisva";
                const cleanText = text.toString().trim();
                const isExplicitlyFree = /LT advert|savireklama/i.test(cleanText) || /SOCN$|{N}$/.test(cleanText);
                if (isExplicitlyFree) return "nemokamas";

                const hasOrderNumber = /\b\d{4}\b/.test(cleanText);
                const initialsMatch = cleanText.match(/[A-Z]\.\s*[A-Z]\./g) || [];
                const hasValidInitials = initialsMatch.some(init => init.replace(/\s/g, '') !== 'R.P.');

                if (hasOrderNumber && hasValidInitials) return "mokamas";
                return "nemokamas";
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setFileName(file.name);
                setLoading(true);
                setErrorInfo("");
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const dataArr = new Uint8Array(event.target.result);
                        const workbook = XLSX.read(dataArr, { type: 'array', cellDates: true });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { defval: "" });

                        if (jsonData.length === 0) {
                            setErrorInfo("Failas tuščias.");
                        } else {
                            const firstRow = jsonData[0];
                            const kKodas = findKey(firstRow, ["Stendo kodas", "Kodas", "ID"]);
                            const kData = findKey(firstRow, ["Data", "Date"]);
                            const kKategorija = findKey(firstRow, ["N - Kategorija", "Kategorija", "Category"]);
                            const kMiestas = findKey(firstRow, ["Miestas", "City"]);
                            const kAdresas = findKey(firstRow, ["Pardavimų adresas", "Adresas", "Address"]);
                            const kPardavimas = findKey(firstRow, ["Pardavimas", "Client", "Klientas"]);
                            const kStatusas = findKey(firstRow, ["Statusas", "Status"]);
                            const kTipas = findKey(firstRow, ["Tipas", "Type"]);

                            const normalized = jsonData.map(row => ({
                                Kodas: row[kKodas] || "",
                                Data: formatDate(row[kData]),
                                Kategorija: row[kKategorija] || "Kita",
                                Pardavimas: row[kPardavimas] || "",
                                Statusas: row[kStatusas] || "",
                                Miestas: row[kMiestas] || "",
                                Adresas: row[kAdresas] || "",
                                Tipas: row[kTipas] || "",
                                SaleType: getSaleType(row[kPardavimas])
                            })).filter(r => r.Kodas);

                            setData(normalized);
                        }
                    } catch (err) { 
                        setErrorInfo("Klaida nuskaitant failą.");
                    }
                    setLoading(false);
                };
                reader.readAsArrayBuffer(file);
            };

            const standInventory = useMemo(() => {
                const inventory = new Map();
                if (!data.length) return inventory;
                
                data.forEach(row => {
                    const code = row.Kodas;
                    if (!code) return;
                    const rawStatus = (row.Statusas || "").toLowerCase();
                    let calculatedStatus = "Aktyvus";
                    if (rawStatus.includes("x")) {
                        calculatedStatus = "Neaktyvus";
                    } else if (rawStatus.includes("ruošiama") || rawStatus.includes("remontuojama")) {
                        calculatedStatus = "Laikinai neveikia";
                    }

                    if (!inventory.has(code)) {
                        inventory.set(code, {
                            kodas: code,
                            miestas: row.Miestas || "Nenurodyta",
                            adresas: row.Adresas || "Nenurodyta",
                            tipas: row.Tipas || "Nenurodyta",
                            kategorija: row.Kategorija || "Kita",
                            status: calculatedStatus,
                            catKey: (row.Kategorija || "Kita").toLowerCase().trim()
                        });
                    } else if (calculatedStatus === "Aktyvus" && inventory.get(code).status !== "Aktyvus") {
                        inventory.get(code).status = "Aktyvus";
                    }
                });
                return inventory;
            }, [data]);

            const filterOptions = useMemo(() => {
                const cities = new Set();
                const categories = new Set();
                standInventory.forEach(s => {
                    if (s.miestas) cities.add(s.miestas);
                    if (s.kategorija) categories.add(s.kategorija);
                });
                return {
                    cities: Array.from(cities).sort(),
                    categories: Array.from(categories).sort()
                };
            }, [standInventory]);

            const ORDER_MUSU = ["Vilnius", "Kaunas", "Klaipėda", "Šiauliai", "Panevėžys", "Regionai", "Kolonos", "Vitrinos", "Nestandartai"];
            const ORDER_SUBNUOMA = ["Subnuoma", "Vitrinos sub"];

            const standList = useMemo(() => {
                let list = Array.from(standInventory.values());
                if (filterCity) list = list.filter(s => s.miestas === filterCity);
                if (filterCat) list = list.filter(s => s.kategorija === filterCat);
                if (filterStatus) list = list.filter(s => s.status === filterStatus);
                return list;
            }, [standInventory, filterCity, filterCat, filterStatus]);

            const report = useMemo(() => {
                if (!data.length || !startMonth || !endMonth) return null;

                const summary = {};
                const monthsSet = new Set();
                const start = new Date(startMonth + "-01");
                const end = new Date(endMonth + "-01");
                let current = new Date(start);
                while (current <= end) {
                    monthsSet.add(current.toISOString().substring(0, 7));
                    current.setMonth(current.getMonth() + 1);
                }
                const sortedMonths = Array.from(monthsSet).sort();
                const allCats = [...ORDER_MUSU, ...ORDER_SUBNUOMA];
                
                allCats.forEach(c => {
                    const catKey = c.toLowerCase();
                    const potCount = Array.from(standInventory.values())
                        .filter(s => s.catKey === catKey && s.status !== "Neaktyvus").length;

                    summary[catKey] = { name: c, potentialUnits: potCount, monthlyStats: {} };
                    sortedMonths.forEach(m => {
                        const [y, mon] = m.split('-').map(Number);
                        const daysInMonth = new Date(y, mon, 0).getDate();
                        summary[catKey].monthlyStats[m] = {
                            uniqueSoldStands: new Set(), soldDaysCount: 0, potentialDays: potCount * daysInMonth
                        };
                    });
                });

                data.forEach(row => {
                    const rowDate = row.Data;
                    if (!rowDate || rowDate.length < 7) return;
                    const m = rowDate.substring(0, 7);
                    const catKey = row.Kategorija.toLowerCase().trim();
                    const stats = summary[catKey]?.monthlyStats[m];
                    if (!stats) return;
                    const client = row.Pardavimas;
                    if (!client || client.toString().trim().length === 0) return;
                    const matchesFilter = saleFilter === "bendrai" || row.SaleType === saleFilter;
                    if (matchesFilter) {
                        stats.uniqueSoldStands.add(row.Kodas);
                        stats.soldDaysCount += 1;
                    }
                });

                const calculateTotal = (list, name) => {
                    const total = { name, potentialUnits: 0, monthlyStats: {} };
                    list.forEach(cName => {
                        const s = summary[cName.toLowerCase()];
                        if (!s) return;
                        total.potentialUnits += s.potentialUnits;
                        sortedMonths.forEach(m => {
                            if (!total.monthlyStats[m]) {
                                total.monthlyStats[m] = { uniqueSoldStands: new Set(), soldDaysCount: 0, potentialDays: 0 };
                            }
                            const ms = s.monthlyStats[m];
                            ms.uniqueSoldStands.forEach(id => total.monthlyStats[m].uniqueSoldStands.add(id));
                            total.monthlyStats[m].soldDaysCount += ms.soldDaysCount;
                            total.monthlyStats[m].potentialDays += ms.potentialDays;
                        });
                    });
                    return total;
                };

                return { months: sortedMonths, summary, visoMusu: calculateTotal(ORDER_MUSU, "VISO MŪSŲ"), visoSubnuoma: calculateTotal(ORDER_SUBNUOMA, "VISO SUBNUOMA"), grandTotal: calculateTotal([...ORDER_MUSU, ...ORDER_SUBNUOMA], "ABSOLIUČIAI VISKAS") };
            }, [data, startMonth, endMonth, standInventory, saleFilter]);

            const monthColSpan = useMemo(() => {
                const s_count = [vis.s_pot, vis.s_free, vis.s_used_pct, vis.s_free_pct].filter(Boolean).length;
                const k_count = [vis.k_pot, vis.k_used, vis.k_used_pct, vis.k_free_pct].filter(Boolean).length;
                return { s_count, k_count, total: s_count + k_count };
            }, [vis]);

            const monthNames = { "01": "Sausis", "02": "Vasaris", "03": "Kovas", "04": "Balandis", "05": "Gegužė", "06": "Birželis", "07": "Liepa", "08": "Rugpjūtis", "09": "Rugsėjis", "10": "Spalis", "11": "Lapkritis", "12": "Gruodis" };

            const toggleCol = (key) => setVis(prev => ({ ...prev, [key]: !prev[key] }));
            const toggleGroup = (group) => {
                const keys = group === 'stendai' ? ['s_pot', 's_free', 's_used_pct', 's_free_pct'] : ['k_pot', 'k_used', 'k_used_pct', 'k_free_pct'];
                const newState = !vis[keys[0]];
                setVis(prev => {
                    const upd = {...prev};
                    keys.forEach(k => upd[k] = newState);
                    return upd;
                });
            };

            const renderRow = (s, isTotal = false) => {
                if (!s) return null;
                const potUnits = s.potentialUnits || 0;
                return (
                    <tr key={s.name} className={`border-b border-gray-50 hover:bg-indigo-50/20 transition-colors ${isTotal ? 'bg-indigo-100 font-black text-indigo-900' : ''}`}>
                        <td className={`p-3 border-r sticky left-0 z-10 shadow-sm ${isTotal ? 'bg-indigo-100' : 'bg-white text-gray-600 font-bold'}`}>{s.name}</td>
                        {report.months.map(m => {
                            const stats = s.monthlyStats[m];
                            const usedUnits = stats?.uniqueSoldStands.size || 0;
                            const freeUnits = Math.max(0, potUnits - usedUnits);
                            const unitRate = potUnits > 0 ? Math.min(100, (usedUnits / potUnits) * 100) : 0;
                            const usedDays = stats?.soldDaysCount || 0;
                            const potDays = stats?.potentialDays || 0;
                            const dayRate = potDays > 0 ? Math.min(100, (usedDays / potDays) * 100) : 0;
                            const dayFreeRate = Math.max(0, 100 - dayRate);

                            return (
                                <Fragment key={m}>
                                    {/* STENDAI BLOKAS */}
                                    {vis.s_pot && <td className="p-2 border-r text-center font-black text-black">{potUnits}</td>}
                                    {vis.s_free && <td className={`p-2 border-r text-center font-bold text-red-600`}>{freeUnits}</td>}
                                    {vis.s_used_pct && <td className={`p-2 border-r text-center font-black ${unitRate > 0 ? 'text-emerald-600' : 'text-gray-300'}`}>{unitRate.toFixed(1)}%</td>}
                                    {vis.s_free_pct && <td className={`p-2 border-r text-center font-bold ${unitRate < 100 ? 'text-red-600' : 'text-gray-300'}`}>{(100 - unitRate).toFixed(1)}%</td>}
                                    
                                    {/* KABĖJIMAS BLOKAS */}
                                    {vis.k_pot && <td className="p-2 border-r text-center font-black text-black">{potDays}</td>}
                                    {vis.k_used && <td className={`p-2 border-r text-center font-black ${usedDays > 0 ? 'text-emerald-600' : 'text-gray-300'}`}>{usedDays}</td>}
                                    {vis.k_used_pct && <td className={`p-2 border-r text-center font-black ${dayRate > 0 ? 'text-emerald-600' : 'text-gray-300'}`}>{dayRate.toFixed(1)}%</td>}
                                    {vis.k_free_pct && <td className={`p-2 border-r text-center font-bold ${dayRate < 100 ? 'text-red-600' : 'text-gray-300'}`}>{dayFreeRate.toFixed(1)}%</td>}
                                </Fragment>
                            );
                        })}
                    </tr>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-8">
                    <div className="max-w-full mx-auto">
                        <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-6">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                <div className="flex items-center gap-3">
                                    <div className="bg-indigo-600 p-2 rounded-xl text-white"><IconFile /></div>
                                    <div>
                                        <h1 className="text-2xl font-black text-indigo-900 tracking-tight leading-none mb-1">STATIKA <span className="font-normal text-indigo-400 text-sm tracking-normal">PRO</span></h1>
                                        <p className="text-gray-400 text-[10px] uppercase font-bold tracking-widest text-center">Užimtumo Analizė</p>
                                    </div>
                                </div>
                                <label className="flex items-center gap-2 px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl text-sm font-bold cursor-pointer transition-all shadow-lg shadow-indigo-100">
                                    <IconUpload /> Įkelti failą
                                    <input type="file" className="hidden" onChange={handleFileUpload} accept=".xlsx,.xls,.csv" />
                                </label>
                            </div>
                            {data.length > 0 && (
                                <div className="flex border-b border-gray-100 mt-6 overflow-x-auto whitespace-nowrap">
                                    <button onClick={() => setActiveTab("ataskaita")} className={`px-6 py-3 text-sm font-bold transition-all border-b-2 ${activeTab === "ataskaita" ? "border-indigo-600 text-indigo-600" : "border-transparent text-gray-400 hover:text-gray-600"}`}>Mėnesių ataskaita</button>
                                    <button onClick={() => setActiveTab("registras")} className={`px-6 py-3 text-sm font-bold transition-all border-b-2 ${activeTab === "registras" ? "border-indigo-600 text-indigo-600" : "border-transparent text-gray-400 hover:text-gray-600"}`}>Stendų registras</button>
                                </div>
                            )}
                        </div>

                        {data.length > 0 && (
                            <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-6 flex flex-wrap items-center gap-6 animate-in fade-in">
                                {activeTab === "ataskaita" ? (
                                    <>
                                        <div className="flex flex-col gap-1"><span className="text-[10px] text-gray-400 font-black uppercase tracking-tighter">Nuo mėnesio</span><input type="month" value={startMonth} onChange={(e) => setStartMonth(e.target.value)} className="bg-gray-50 border border-gray-100 rounded-lg px-3 py-1.5 text-sm font-bold text-indigo-700 outline-none" /></div>
                                        <div className="flex flex-col gap-1"><span className="text-[10px] text-gray-400 font-black uppercase tracking-tighter">Iki mėnesio</span><input type="month" value={endMonth} onChange={(e) => setEndMonth(e.target.value)} className="bg-gray-50 border border-gray-100 rounded-lg px-3 py-1.5 text-sm font-bold text-indigo-700 outline-none" /></div>
                                        <div className="flex flex-col gap-1"><span className="text-[10px] text-gray-400 font-black uppercase tracking-tighter">Pardavimų tipas</span><select value={saleFilter} onChange={(e) => setSaleFilter(e.target.value)} className="bg-indigo-50 border border-indigo-100 rounded-lg px-3 py-1.5 text-sm font-bold text-indigo-700 outline-none"><option value="mokamas">Tik komerciniai</option><option value="nemokamas">Tik nemokami</option><option value="bendrai">Bendrai (visi)</option></select></div>
                                        <div className="relative mt-5">
                                            <button onClick={() => setShowColPicker(!showColPicker)} className={`flex items-center gap-2 px-4 py-2 border rounded-xl text-xs font-bold transition-all ${showColPicker ? 'bg-indigo-50 border-indigo-200 text-indigo-700' : 'bg-white text-gray-600 border-gray-200'}`}><IconSettings /> Stulpelių rodymas</button>
                                            {showColPicker && (
                                                <div className="absolute top-full left-0 mt-2 bg-white border border-gray-100 shadow-2xl rounded-2xl p-5 z-50 min-w-[400px] animate-in slide-in-from-top-2">
                                                    <div className="grid grid-cols-2 gap-8">
                                                        <div className="space-y-2">
                                                            <div className="flex justify-between border-b pb-1"><span className="text-[10px] font-black text-indigo-600 uppercase">Stendai</span><button onClick={() => toggleGroup('stendai')} className="text-[9px] text-indigo-400 font-bold underline decoration-dotted">Perjungti</button></div>
                                                            {[{id:'s_pot',l:'Galimybė'},{id:'s_free',l:'Laisvi'},{id:'s_used_pct',l:'Išnaudota %'},{id:'s_free_pct',l:'Laisvi %'}].map(c=>(<label key={c.id} className="flex items-center gap-2 text-xs cursor-pointer hover:text-indigo-600 py-1"><input type="checkbox" checked={vis[c.id]} onChange={()=>toggleCol(c.id)} className="rounded border-gray-300 text-indigo-600" />{c.l}</label>))}
                                                        </div>
                                                        <div className="space-y-2">
                                                            <div className="flex justify-between border-b pb-1"><span className="text-[10px] font-black text-amber-600 uppercase">Kabėjimas</span><button onClick={() => toggleGroup('kabėjimas')} className="text-[9px] text-amber-400 font-bold underline decoration-dotted">Perjungti</button></div>
                                                            {[{id:'k_pot',l:'Galimybė'},{id:'k_used',l:'Išnaudota'},{id:'k_used_pct',l:'Išnaudojimo %'},{id:'k_free_pct',l:'Laisvi %'}].map(c=>(<label key={c.id} className="flex items-center gap-2 text-xs cursor-pointer hover:text-amber-600 py-1"><input type="checkbox" checked={vis[c.id]} onChange={()=>toggleCol(c.id)} className="rounded border-gray-300 text-amber-600" />{c.l}</label>))}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    <div className="flex flex-col gap-1"><span className="text-[10px] text-gray-400 font-black uppercase">Miestas</span><select value={filterCity} onChange={(e) => setFilterCity(e.target.value)} className="bg-gray-50 border border-gray-100 rounded-lg px-3 py-1.5 text-sm font-bold min-w-[150px] outline-none">{filterOptions.cities.map(city => <option key={city} value={city}>{city}</option>)}</select></div>
                                )}
                            </div>
                        )}

                        {data.length > 0 ? (
                            <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                                {activeTab === "ataskaita" && report ? (
                                    <div className="overflow-x-auto max-h-[75vh]">
                                        <table className="w-full text-xs text-left border-collapse min-w-[2000px] table-fixed">
                                            <thead className="sticky top-0 z-20">
                                                <tr className="bg-gray-100 border-b text-gray-500">
                                                    <th rowSpan="3" className="p-4 border-r sticky left-0 bg-gray-100 z-30 w-52 font-bold shadow-sm">Kategorija</th>
                                                    {report.months.map(m => monthColSpan.total > 0 && <th key={m} colSpan={monthColSpan.total} className="p-2 border-r text-center font-bold text-indigo-900 bg-white border-b-2 border-indigo-100">{monthNames[m.split('-')[1]]} ({m.split('-')[0]})</th>)}
                                                </tr>
                                                <tr className="bg-gray-50 border-b text-[9px] font-black text-center uppercase tracking-widest">
                                                    {report.months.map(m => (
                                                        <Fragment key={`${m}-g`}>
                                                            {monthColSpan.s_count > 0 && <th colSpan={monthColSpan.s_count} className="p-1 border-r text-indigo-600 bg-indigo-50/40">Stendai (vnt.)</th>}
                                                            {monthColSpan.k_count > 0 && <th colSpan={monthColSpan.k_count} className="p-1 border-r text-amber-600 bg-amber-50/40">Kabėjimas (d.)</th>}
                                                        </Fragment>
                                                    ))}
                                                </tr>
                                                <tr className="bg-white border-b text-[8px] font-bold uppercase text-gray-400 text-center">
                                                    {report.months.map(m => (
                                                        <Fragment key={`${m}-d`}>
                                                            {vis.s_pot && <th className="p-1 border-r w-16">Galimybė</th>}
                                                            {vis.s_free && <th className="p-1 border-r w-16 text-red-600 font-black">Laisvi</th>}
                                                            {vis.s_used_pct && <th className="p-1 border-r w-16 text-emerald-600 font-black">Išnaudota %</th>}
                                                            {vis.s_free_pct && <th className="p-1 border-r w-16 text-red-600">Laisvi %</th>}
                                                            {vis.k_pot && <th className="p-1 border-r w-20">Galimybė</th>}
                                                            {vis.k_used && <th className="p-1 border-r w-20 text-emerald-600 font-black">Išnaudota</th>}
                                                            {vis.k_used_pct && <th className="p-1 border-r w-20 text-emerald-600 font-black">Išnaudojimo %</th>}
                                                            {vis.k_free_pct && <th className="p-1 border-r w-20 text-red-600 font-black">Laisvi %</th>}
                                                        </Fragment>
                                                    ))}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr className="bg-gray-100/30"><td colSpan={1 + (report.months.length * monthColSpan.total)} className="p-1.5 px-4 font-black text-[9px] text-gray-400 uppercase tracking-widest border-b text-indigo-900">MŪSŲ</td></tr>
                                                {ORDER_MUSU.map(c => renderRow(report.summary[c.toLowerCase()]))}
                                                {renderRow(report.visoMusu, true)}
                                                <tr className="bg-gray-100/30"><td colSpan={1 + (report.months.length * monthColSpan.total)} className="p-1.5 px-4 font-black text-[9px] text-gray-400 uppercase tracking-widest border-b border-t text-indigo-900">SUBNUOMA</td></tr>
                                                {ORDER_SUBNUOMA.map(c => renderRow(report.summary[c.toLowerCase()]))}
                                                {renderRow(report.visoSubnuoma, true)}
                                                <tr className="bg-indigo-900 text-white"><td colSpan={1 + (report.months.length * monthColSpan.total)} className="p-2 px-4 font-black text-[10px] uppercase tracking-widest text-center">VISI REZULTATAI</td></tr>
                                                {renderRow(report.grandTotal, true)}
                                            </tbody>
                                        </table>
                                    </div>
                                ) : (
                                    <div className="overflow-x-auto max-h-[75vh]">
                                        <table className="w-full text-xs text-left border-collapse">
                                            <thead className="bg-gray-50 border-b font-bold uppercase text-[9px] text-gray-500 tracking-widest sticky top-0 z-20">
                                                <tr><th className="p-4 border-r">Būsena</th><th className="p-4 border-r">Kodas</th><th className="p-4 border-r">Miestas</th><th className="p-4 border-r min-w-[200px]">Adresas</th><th className="p-4 border-r">Kategorija</th></tr>
                                            </thead>
                                            <tbody>
                                                {standList.map((stand, i) => (
                                                    <tr key={i} className="border-b border-gray-50 hover:bg-gray-50 transition-colors">
                                                        <td className="p-3 border-r whitespace-nowrap"><span className={`px-2.5 py-0.5 rounded-full text-[9px] font-black uppercase border ${stand.status === "Aktyvus" ? "bg-emerald-50 text-emerald-600 border-emerald-100" : stand.status === "Neaktyvus" ? "bg-rose-50 text-rose-600 border-rose-100" : "bg-amber-50 text-amber-600 border-amber-100"}`}>{stand.status}</span></td>
                                                        <td className="p-3 border-r font-mono font-bold text-gray-900">{stand.kodas}</td>
                                                        <td className="p-3 border-r text-gray-700 font-bold">{stand.miestas}</td>
                                                        <td className="p-3 border-r text-gray-400 italic text-[11px] truncate max-w-[250px]">{stand.adresas}</td>
                                                        <td className="p-3 text-indigo-500 font-black uppercase text-[10px] tracking-tighter">{stand.kategorija}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}
                            </div>
                        ) : (
                            !loading && (
                                <div className="bg-white rounded-3xl border-2 border-dashed border-gray-200 py-40 text-center shadow-inner animate-in fade-in">
                                    <div className="bg-indigo-50 w-24 h-24 rounded-3xl flex items-center justify-center mx-auto mb-6 text-indigo-300"><IconFile /></div>
                                    <h2 className="text-2xl font-black text-indigo-900 mb-2 uppercase tracking-widest tracking-tight leading-none">Statikos užimtumo ataskaitos</h2>
                                    <p className="text-gray-400 text-sm max-w-xs mx-auto leading-relaxed italic mt-2">Įkelkite „Eksportas_Statika.xlsx“ failą, kad pamatytumėte rodiklius.</p>
                                </div>
                            )
                        )}

                        {loading && (
                            <div className="flex flex-col items-center gap-4 py-32 animate-in fade-in">
                                <div className="w-14 h-14 border-4 border-indigo-100 border-t-indigo-600 rounded-full animate-spin"></div>
                                <p className="text-indigo-900 font-black animate-pulse uppercase tracking-widest text-[10px]">Apdorojama...</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
